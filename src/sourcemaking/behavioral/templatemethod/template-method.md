# [译文]模板方法模式

> 原文网址：[Template Method Design Pattern](https://sourcemaking.com/design_patterns/template_method)

## 意图
- 给某一种操作的算法定义一个骨架，将某些步骤延迟到子类里实现。模板方法模式使得子类可以重新定义算法中的某些步骤，而不改变算法的结构。
- 在基类中定义算法“占位符”，子类中实现这些“占位符”算法。

## 问题
两个不同的组件有明显的相似之处，却没有重用公共的接口或实现。
如果要改变这两个组件，必然会导致重复的工作。

## 讨论
组件的设计者决定算法的哪些步骤是不可变的（或标准的），哪些步骤是可变的（或可定制化的）。
不可变的步骤在抽象的基类中实现，而可变的步骤可以给一个默认的实现，也可以不给。
可变步骤是一种“钩子”或“占位符”，可以或必须由具体的子类实现。

组件的设计者指定算法的必要步骤，并排序，而允许子组件扩展或替换某些步骤。

模板方法模式在框架中被大量使用。每个框架都实现了一个域架构中不可变的部分，
并为所有必要或有趣的定制化操作定义了“占位符”。
这样，框架就成了“宇宙的中心”，而客户定制化就成了“来自太阳的第三块岩石”。
这种方向控制结构被亲切地称为“好莱坞原则”——“别给我们打电话，我们会打给你”。

## 结构

![](https://sourcemaking.com/files/v2/content/patterns/Template_Method.png)

方法 `templateMethod` 的实现包括： `stepOne()`, `stepTwo()`, `stepThree()` 。 `stepTwo` 是一个钩子方法——占位符。
它在基类中申明，在子类中实现。
框架（大规模重用的结构）大量地使用了模板方法。
所有可重用的代码都定义在框架的基础类里，框架的使用者在需要的时候通过创建衍生类来进行定制化。

![](https://sourcemaking.com/files/v2/content/patterns/Template_Method_.png)

## 举例
住房开发商在开发新楼盘时就使用了模板方法。一个典型的楼盘包含着有限的楼层计划，每栋楼可能都不一样。
对于相同的楼层，在平面图、基础框架、管道和布线都是完全一样的。
在施工后期，可以引入变化建造出不同的房屋。

另一个例子是一个人的工作日常。

![](https://sourcemaking.com/files/v2/content/patterns/Template_method_example.png)

## 核查清单（也可以理解为应用步骤）
1. 检查一个算法，看看哪些步骤是可以标准化的，哪些是独特的
2. 定义一个抽象的基类去构建“不要联系我们，我们会联系你”的框架
3. 将这个算法的“壳”（现在是“模板方法”）和所有标准步骤的定义移到一个新的基类里
4. 为每一个需要不同实现的步骤在基类里定义一个占位符或钩子方法。
这个方法可以有一个默认的实现——或者可以被定义成 abstract （Java） 或 pure virtual（C++）
5. 在模板方法中调用这些钩子方法
6. 每一个类跟这个新的抽象类都是“IS-A”的关系
7. 将所有已被移到基类中实现都从类中移除
8. 在每个类中唯一应该保留的是独特的实现部分

## 经验法则
- 策略模式修改单个对象的逻辑；而模板方法模式修改的是整个类的逻辑
- 工厂模式是模板方法模式的特例